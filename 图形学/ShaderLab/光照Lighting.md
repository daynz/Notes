## 标准光照模型

### 简介

标准光照模型仅仅是一个经验模型，它并不完全符合真实世界中的光照现象。但由于它的易用性、计算速度和得到的效果都比较好，因此仍然被广泛使用。

但这种模型有很多局限性。

1. 有很多重要的物理现象无法用Blinn-Phong模型表现出来，例如菲涅耳反射（Fresnel reflection）。
2. Blinn-Phong模型是各项同性（isotropic）的，当我们固定视角和光源方向旋转这个表面时，反射不会发生任何改变。但有些表面是具有各向异性（anisotropic）反射性质的，例如拉丝金属、毛发等。

**自发光**：物体本身发出的光，与光线入射角度无关，通常用于模拟自身发光的物体，如灯光或者荧光物体。

**环境光**：模拟间接光照，即光线在场景中多次反射后的效果。环境光通常是一个常数，对所有物体都是一样的，用于避免没有直接光照的区域完全黑暗。

**漫反射**：模拟光线照射到物体表面后，被均匀地向各个方向反射的现象。漫反射的强度通常与光线入射角度的余弦值成正比，符合兰伯特定律。

**高光反射**：模拟光线在物体表面的镜面反射。这种现象在光滑的表面上尤为明显，如金属、塑料等。高光反射的强度取决于视角、光源方向和物体表面的反射特性。Phong模型和Blinn-Phong模型是计算高光反射的两种常见方法。

### 详细

#### 自发光*emissive*

光线可以直接由光源发射进入摄像机，不需要结果任何物体的反射。在片元着色器输出最后的颜色之前，将材质的自发光颜色添加到输出颜色上即可。

自发光的表面往往不会照亮周围的表面，这个物体不会被当做一个光源。大多物品没有自发光特性。
$$
\mathbf c_{emissive} = \mathbf m_{emissive}
$$
#### 环境光*ambient*

近似模拟间接光照。所有场景都使用这个环境光。

$$
\mathbf c_{ambient} = \mathbf g_{ambient}
$$
#### 漫反射*diffuse*

漫反射光照是用于对那些被物体表面随机散射到各个方向的辐射度进行建模的。在漫反射中，视角的位置是不重要的,因为反射是完全随机的,因此可以认为在任何反射方向上的分布都是一样的。但是，入射光线的角度很重要。

漫反射光照符合**兰伯特定律(Lambert's law)**：反射光线的强度与表面法线和光源方向之间夹角的余弦值成正比。
$$ 
\mathbf c_{diffuse} = \mathbf c_{light} \cdot \mathbf m_{diffuse} \cdot max(0, \mathbf{\hat{n}} \cdot \mathbf I)
$$
> `c` `m` 是指颜色
> `n`是表面法线
> `I`是指向光源的单位向量
#### 高光反射*specular*

计算高光反射需要知道的信息比较多,如表面法线`n`、视角方向`v`、光源方向`I`、反射方向`r`等。我们假设这些矢量都是单位矢量。

![[Specular.png]]

在这四个矢量中，只需要知道其中 3个矢量即可，而第四个矢量——反射方向可以通过其他信息计算得到。
$$
\mathbf r = 2 (\mathbf{\hat n} \cdot \mathbf I) \mathbf{\hat n} - \mathbf I
$$
##### Phong模型
$$
\mathbf c_{specular} = \mathbf c_{light} \cdot m_{specular} \cdot max(0, \mathbf{\hat v} \cdot \mathbf r) ^ {m_{gloss}}
$$
##### Blinn-Phong模型

$$
c_{specular} = c_{light} * m_{specular} * max(0, \mathbf{\hat v} \cdot \textbf h) ^ {m_{gloss}}
$$
基本思想：避免计算反射方向$\hat v$，为此引入一个新矢量$\hat  h$。

$$
\hat h = \frac{\hat v + \mathbf I} {\lvert \hat v + \mathbf I \rvert} 
$$

> `gloss`光泽度，也称反光度（shininess）。用于控制高光区域的亮点的大小。

### 计算位置

#### 逐像素

在片元着色器中计算，称为逐像素着色（per-pixel light）

在逐像素光照中，以每个像素为基础，得到它的法线（可以是对顶点法线插值得到的，也可以是从法线纹理中采样得到的），然后进行光照模型的计算。这种在面片之间对顶点法线进行插值的技术被称为Phong着色（Phong shading），也被称为Phong插值或法线插值着色技术（不同于之前的Phong光照模型）。
#### 逐顶点

在顶点着色器中计算，称为逐顶点着色（per-vertex light）

在逐顶点光照中，在每个顶点上计算光照，然后会在渲染图元内部进行线性插值，最后输出成像素颜色。被称为高洛德着色(Gouraud shading)

#### 逐像素和逐顶点

由于顶点数目往往远小于像素数目，因此逐顶点光照的计算量往往要小于逐像素光照。但是，由于逐顶点光照依赖于线性插值来得到像素光照，当光照模型中有非线性的计算（例如计算高光反射时）时，逐顶点光照就会出问题。而且，由于逐顶点光照会在渲染图元内部对顶点颜色进行插值,这会导致渲染图元内部的颜色总是暗于顶点处的最高颜色值，这在某些情况下会产生明显的棱角现象。